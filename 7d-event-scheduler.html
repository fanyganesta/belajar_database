<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Type</title>
    <link rel="stylesheet" href="css/index.css">
</head>
<body>
    <div class="container">
        <aside id="aside">

        </aside>

        <main>
            <header>
                
            </header>
            
            <div class="content">    
                <h2>7.4 Event Scheduler â€” Cron Job di Level Database</h2>

                â€œKalau aplikasi mati tapi database hidup, event scheduler tetap jalan.â€
                Dan itu bisa jadi penyelamatâ€¦ atau mimpi buruk ğŸ˜ˆ

                <br> <hr> <br>


                1ï¸âƒ£ Apa itu Event Scheduler?

                Event Scheduler adalah fitur MySQL yang memungkinkan database menjalankan query secara otomatis berdasarkan waktu.

                Singkatnya:

                Cron job tapi nempel di database

                Jalan tanpa campur tangan aplikasi

                Time-based, bukan request-based

                ğŸ“Œ Contoh:

                Hapus data sementara tiap malam

                Generate laporan harian

                Reset counter bulanan

                Auto-archive data lama

                <br> <hr> <br>


                2ï¸âƒ£ Bedanya dengan Cron di Server / Queue Job?
                Aspek	Event Scheduler	Cron / Queue
                Lokasi	Database	Server / App
                Trigger	Waktu	Waktu / Event
                Butuh aplikasi hidup	âŒ Tidak	âœ… Ya
                Kontrol logika kompleks	âŒ Terbatas	âœ… Fleksibel
                Risiko tersembunyi	âš ï¸ Tinggi	âš ï¸ Sedang

                ğŸ‘‰ Rule kasar

                Logic berat â†’ aplikasi

                Maintenance data â†’ database

                <br> <hr> <br>


                3ï¸âƒ£ Mengaktifkan Event Scheduler (WAJIB)

                Secara default sering OFF ğŸ”•

                SET GLOBAL event_scheduler = ON;


                Cek status:

                SHOW VARIABLES LIKE 'event_scheduler';


                âš ï¸ Catatan:

                Di shared hosting: sering tidak diizinkan

                Di production: harus seizin DBA / infra

                <br> <hr> <br>


                4ï¸âƒ£ Contoh Dasar Event
                Event jalan setiap hari jam 00:00
                CREATE EVENT cleanup_temp_data
                ON SCHEDULE EVERY 1 DAY
                STARTS '2026-01-01 00:00:00'
                DO
                DELETE FROM temp_orders
                WHERE created_at < NOW() - INTERVAL 7 DAY;


                ğŸ“Œ Ini langsung nembak database, tanpa Laravel, tanpa cron server.

                <br> <hr> <br>


                5ï¸âƒ£ Real Case yang Masuk Akal (Best Practice)
                âœ… Auto Archive Data Lama
                CREATE EVENT archive_orders
                ON SCHEDULE EVERY 1 DAY
                DO
                BEGIN
                INSERT INTO orders_archive
                SELECT * FROM orders
                WHERE created_at < NOW() - INTERVAL 1 YEAR;

                DELETE FROM orders
                WHERE created_at < NOW() - INTERVAL 1 YEAR;
                END;


                ğŸ§  Cocok untuk:

                Log besar

                History transaksi lama

                Table yang bikin query makin lambat

                <br> <hr> <br>


                6ï¸âƒ£ Contoh Berbahaya (Anti Pattern ğŸ˜ˆ)
                âŒ Update data bisnis utama
                UPDATE users SET status = 'expired';


                Tanpa:

                Validasi user

                Context aplikasi

                Logging proper

                ğŸ‘‰ Kalau error?
                ğŸ‘‰ Kalau logic berubah?
                ğŸ‘‰ Kalau ada bug jam 00:00?

                ğŸ’¥ Database tetap nurut, aplikasi yang nangis

                <br> <hr> <br>


                7ï¸âƒ£ Event Scheduler + Audit Log (WAJIB)

                Event HARUS log ke audit table

                INSERT INTO system_logs (
                source,
                action,
                executed_at
                ) VALUES (
                'event_scheduler',
                'cleanup temp_orders',
                NOW()
                );


                ğŸ“Œ Ingat Bab 7.3?

                â€œSemua automation wajib bisa dilacak.â€

                <br> <hr> <br>


                8ï¸âƒ£ Kapan Event Scheduler BOLEH Dipakai?

                âœ… Pakai kalau:

                Maintenance data

                Cleanup

                Archiving

                Reset statistik

                Auto generate laporan ringan

                âŒ Jangan pakai kalau:

                Logic bisnis utama

                Perhitungan kompleks

                Butuh conditional logic panjang

                Butuh rollback kompleks

                <br> <hr> <br>


                9ï¸âƒ£ Event Scheduler vs Queue Job (Laravel)
                Kebutuhan	Pilihan
                Cleanup data	Event
                Sync API	Queue
                Kirim email	Queue
                Generate invoice	Queue
                Archive data	Event
                Hitung komisi	âŒ Jangan Event
                ğŸ”š Penutup Bab 7 â€” Database Bukan Tempat Sok Pintar

                <br> <hr> <br>


                Bab 7 intinya satu:

                Database itu mesin, bukan otak.

                View â†’ bantu baca data

                Stored Procedure â†’ pisau bermata dua

                Trigger â†’ otomatis tapi berbahaya

                Event Scheduler â†’ jalan sendiri tanpa izin aplikasi

                Kalau kamu pindahkan terlalu banyak logika ke database:

                Debug makin susah

                Developer baru tersesat

                Bug muncul tanpa jejak

                <br> <br>

                <hr>

                <br> <br>

                <a href="8a-sql-injection.html" class="btn-next">8a. SQL Injection</a>
            </div>
        </main>
    </div>

    <script>
        fetch('layout/aside.html').then(response => response.text()).then(data => {
            document.getElementById('aside').innerHTML = data;

            const currentPage = window.location.pathname.split('/').pop();
            const links = document.querySelectorAll('aside a');

            links.forEach(link => {
                if(link.getAttribute('href') == currentPage){
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>