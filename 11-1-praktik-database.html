<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Type</title>
    <link rel="stylesheet" href="css/index.css">
</head>
<body>
    <div class="container">
        <aside id="aside">

        </aside>

        <main>
            <header>
                
            </header>

<pre style="background-color: white; color: black; width: 100%">
PRAKTIK DATABASE

A. Task:
    1. Buat rancangan database untuk bisa relasional tipe:
        a. one to one
        b. one to many
        c. many to many

    2. Buat data mentahnya masing masing 30 data.
    3. Lakukan proses Alter Table
    4. Berikan seuah Column memiliki aturan Unique
    5. Coba insert 1 data dengan relasi
    6. Coba update 1 data dengan relasi
    7. Coba delete data dengan relasi
    8. Coba cari data dengan AND, OR, Like, In, Between, Order By, dan Limit Offset
    9. Coba join (inner, left, rigth dan self)
    10. Coba Agregate (count, sum, avg, group by, dan having)
    11. Coba softdelete dan problemnya
    12. Coba transaction
    13. Coba auto insert Log dengan trigger

B. Rancangan Database:
    1. Table Lists
        a. users
        b. user_profiles
        c. merchants
        d. merchant_profiles
        e. products
        f. orders
        g. order_items
        h. categories

    2. Table Relations
        a. One to one
            1. users -> user_profiles
            2. merchants -> merchant_profiles
            3. users -> merchants

        b. One to many
            1. merchants -> products
            2. users -> orders
            3. orders -> order_items

        c. Many to many
            1. products -> categories

    3. Table Details
        1. users:
            a. id
            b. username (index)
            c. name
            d. email (index)
            e. role (seller/buyer)
            f. Alter Table:
                1. Column:
                    a. master (to self join)
            g. deleted_at

        2. user_profiles
            a. id
            b. user_id (UNIQUE) -> FK user.id
            c. birth_date
            d. address
            e. instagram
            f. tiktok
            g. bio
            h. deleted_at

        3. merchants
            a. id
            b. user_id -> FK users.id
            c. name
            d. username (index)
            e. address
            f. deleted_at

        4. merchant_profiles
            a. id
            b. merchant_id (UNIQUE) -> FK merchants.id
            c. avatar
            d. email
            e. phone
            f. website
            g. deleted_at
            
        5. products
            a. id
            b. merchant_id -> FK merchants.id
            c. name
            d. image
            e. quantity
            f. price
            g. deleted_at

        6. orders
            a. id
            b. user_id -> FK users.id
            c. merchant_id -> FK merchants.id
            d. order_numbers (index)
            e. checkout_date
            f. status (index) (paid/canceled/expired/refund)
            g. updated_at
            h. composite index (user_id, merchant_id)
            i. deleted_at

        7. order_items
            a. id
            b. order_id -> FK (UNIQUE) orders.id
            c. product_id -> FK (UNIQUE) products.id
            d. quantity
            e. total
            f. composite index (order_id, product_id)
            g. deleted_at

        8. categories
            a. id
            b. name
            c. deleted_at

        9. product_categories
            a. product_id -> FK products.id
            b. category_id -> FK categories.id
            c. composite index (product_id, category_id)
            d. deleted_at

        10. audit_logs
            a. id
            b. table_name
            c. record_id
            d. action (insert/update/delete)
            e. old_data (JSON)
            f. new_data (JSON)
            g. created_at
            h. deleted_at

    4. ERD 
        1. Link https://app.diagrams.net/?src=about#G1vP4s10RQ3_8-lDiBH_4bxuv-gEU0IfxC#%7B%22pageId%22%3A%22_u7ztZJYVYy_aFD5fLoU%22%7D

        2. Diagram
<img src="img/Belajar Database 1.drawio (1).png" alt="diagram database" style="max-width: 100%; box-sizing: border-box">

        3. Query SQL
            a. Create Table users
                CREATE TABLE `belajar_database`.`users` (`id` INT NOT NULL AUTO_INCREMENT , `username` VARCHAR(100) NOT NULL , `name` VARCHAR(100) NOT NULL , `email` VARCHAR(255) NOT NULL , `role` ENUM('buyer','seller') NOT NULL , `deleted_at` TIMESTAMP NULL , PRIMARY KEY (`id`), INDEX `idx_username_users` (`username`), INDEX `idx_email_users` (`email`)) ENGINE = InnoDB;

            b. Create Table user_profiles
                CREATE TABLE `belajar_database`.`user_profiles` (`id` INT NOT NULL AUTO_INCREMENT , `user_id` INT NOT NULL , `birth_date` DATE NOT NULL , `address` VARCHAR(255) NOT NULL , `instagram` VARCHAR(100) NOT NULL , `tiktok` VARCHAR(100) NOT NULL , `bio` TEXT NOT NULL , `deleted_at` TIMESTAMP NULL , PRIMARY KEY (`id`, `user_id`)) ENGINE = InnoDB;

            c. (ALTER) Create Relation user_profiles.user_id -> users.id
                ALTER TABLE `user_profiles` ADD CONSTRAINT `fk_user_id` FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE;

            d. Create Table merchants
                CREATE TABLE `belajar_database`.`merchants` (`id` INT NOT NULL AUTO_INCREMENT , `user_id` INT NOT NULL , `name` VARCHAR(100) NOT NULL , `username` VARCHAR(100) NOT NULL , `address` VARCHAR(255) NOT NULL , `deleted_at` TIMESTAMP NOT NULL , PRIMARY KEY (`id`, `user_id`), INDEX `idx_username_merchants` (`username`)) ENGINE = InnoDB;

            e. (ALTER) Create Relation merchants.user_id -> users.id
                ALTER TABLE `merchants` ADD CONSTRAINT `fk_user_id_merchants` FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE;

            f. Create Table merchant_profiles
                CREATE TABLE `belajar_database`.`merchant_profiles` (`id` INT NOT NULL AUTO_INCREMENT , `merchant_id` INT NOT NULL , `avatar` VARCHAR(255) NOT NULL , `email` VARCHAR(255) NOT NULL , `phone` VARCHAR(100) NOT NULL , `website` VARCHAR(255) NOT NULL , `deleted_at` TIMESTAMP NOT NULL , PRIMARY KEY (`id`), INDEX `idx_merchant_id_merchant_profiles` (`merchant_id`)) ENGINE = InnoDB;

            g. Make relation one to one users -> user_profiles
                ALTER TABLE `user_profiles` ADD UNIQUE(`user_id`);
            
            h. Make relation one to one merchants -> merchant_profiles
                ALTER TABLE `merchant_profiles` ADD CONSTRAINT `fk_merchant_id` FOREIGN KEY (`merchant_id`) REFERENCES `merchants`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE;
                ALTER TABLE `merchant_profiles` ADD UNIQUE(`merchant_id`);
            
            i. Create Table products
                CREATE TABLE `belajar_database`.`products` (`id` INT NOT NULL AUTO_INCREMENT , `merchant_id` INT NOT NULL , `name` VARCHAR(255) NOT NULL , `image` VARCHAR(255) NOT NULL , `quantity` INT(100) UNSIGNED NOT NULL , `price` DECIMAL(11,2) UNSIGNED NOT NULL , `deleted_at` TIMESTAMP NOT NULL , PRIMARY KEY (`id`), INDEX `id_merchant_id_products` (`merchant_id`)) ENGINE = InnoDB;

            j. Create relation products -> merchants
                ALTER TABLE `products` ADD CONSTRAINT `fk_merchant_id_products` FOREIGN KEY (`merchant_id`) REFERENCES `merchants`(`id`) ON DELETE RESTRICT ON UPDATE RESTRICT;

            k. Create Table orders
                CREATE TABLE `belajar_database`.`orders` (`id` INT NOT NULL AUTO_INCREMENT , `user_id` INT NOT NULL , `merchant_id` INT NOT NULL , `order_numbers` VARCHAR(255) NOT NULL , `checkout_date` TIMESTAMP NOT NULL , `status` ENUM('paid','canceled','expired','refund') NOT NULL , `updated_at` TIMESTAMP NULL , `deleted_at` TIMESTAMP NULL , PRIMARY KEY (`id`)) ENGINE = InnoDB;

            l. Create relation orders -> users & orders -> merchants
                ALTER TABLE `orders` ADD CONSTRAINT `fk_user_id_users` FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE; ALTER TABLE `orders` ADD CONSTRAINT `fk_merchant_id_merchants` FOREIGN KEY (`merchant_id`) REFERENCES `merchants`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE;

            m. Create composite index users_id & merchant_id -> orders
                ALTER TABLE `belajar_database`.`orders` ADD INDEX `idx_user_id_merchant_id` (`user_id`, `merchant_id`);

            n. Create Table order_items
                CREATE TABLE `belajar_database`.`order_items` (`id` INT NOT NULL AUTO_INCREMENT , `order_id` INT NOT NULL , `product_id` INT NOT NULL , `quantity` INT NOT NULL , `total` DECIMAL NOT NULL , `deleted_at` INT NULL , PRIMARY KEY (`id`)) ENGINE = InnoDB;

            o. Create relation order_items -> orders & order_items -> products
                ALTER TABLE `order_items` ADD CONSTRAINT `fk_order_id_order_items` FOREIGN KEY (`order_id`) REFERENCES `orders`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE; ALTER TABLE `order_items` ADD CONSTRAINT `fk_product_id_products` FOREIGN KEY (`product_id`) REFERENCES `products`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE;

            p. Create composite index(order_id -> product_id)
                ALTER TABLE `belajar_database`.`order_items` ADD INDEX `idx_order_id_product_id` (`order_id`, `product_id`);

            q. Create table categories
                CREATE TABLE `belajar_database`.`categories` (`id` INT NOT NULL AUTO_INCREMENT , `name` VARCHAR(255) NOT NULL , `deleted_at` TIMESTAMP NULL , PRIMARY KEY (`id`)) ENGINE = InnoDB;

            r. Create table pivot many to many (category_product)
                CREATE TABLE `belajar_database`.`category_product` (`product_id` INT NOT NULL , `category_id` INT NOT NULL , `deleted_at` TIMESTAMP NULL ) ENGINE = InnoDB;

            s. Create composite index pivot table (category_product)
                ALTER TABLE `belajar_database`.`category_product` ADD INDEX `idx_product_id_category_id` (`product_id`, `category_id`);

            t. Create index only at category (category_product)
                ALTER TABLE `belajar_database`.`category_product` ADD INDEX `idx_category_id` (`product_id`);

            u. Create Table audit_logs
                CREATE TABLE `belajar_database`.`audit_logs` (`id` INT NOT NULL AUTO_INCREMENT , `table_name` VARCHAR(255) NOT NULL , `record_id` INT NOT NULL , `action` ENUM('insert','update','delete') NOT NULL , `old_data` JSON NOT NULL , `new_data` JSON NOT NULL , `created_at` TIMESTAMP NOT NULL , `deleted_at` TIMESTAMP NULL , PRIMARY KEY (`id`), INDEX `idx_record_id` (`record_id`), INDEX `idx_table_name` (`table_name`), INDEX `idx_created_at` (`created_at`)) ENGINE = InnoDB;


            GABUNGAN:

                CREATE DATABASE belajar_database;

                CREATE TABLE `belajar_database`.`users` (`id` INT NOT NULL AUTO_INCREMENT , `username` VARCHAR(100) NOT NULL , `name` VARCHAR(100) NOT NULL , `email` VARCHAR(255) NOT NULL , `role` ENUM('buyer','seller') NOT NULL , `deleted_at` TIMESTAMP NULL , PRIMARY KEY (`id`), INDEX `idx_username_users` (`username`), INDEX `idx_email_users` (`email`)) ENGINE = InnoDB;

                CREATE TABLE `belajar_database`.`user_profiles` (`id` INT NOT NULL AUTO_INCREMENT , `user_id` INT NOT NULL , `birth_date` DATE NOT NULL , `address` VARCHAR(255) NOT NULL , `instagram` VARCHAR(100) NOT NULL , `tiktok` VARCHAR(100) NOT NULL , `bio` TEXT NOT NULL , `deleted_at` TIMESTAMP NULL , PRIMARY KEY (`id`, `user_id`)) ENGINE = InnoDB;

                ALTER TABLE `user_profiles` ADD CONSTRAINT `fk_user_id` FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE;

                CREATE TABLE `belajar_database`.`merchants` (`id` INT NOT NULL AUTO_INCREMENT , `user_id` INT NOT NULL , `name` VARCHAR(100) NOT NULL , `username` VARCHAR(100) NOT NULL , `address` VARCHAR(255) NOT NULL , `deleted_at` TIMESTAMP NOT NULL , PRIMARY KEY (`id`, `user_id`), INDEX `idx_username_merchants` (`username`)) ENGINE = InnoDB;

                ALTER TABLE `merchants` ADD CONSTRAINT `fk_user_id_merchants` FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE;

                CREATE TABLE `belajar_database`.`merchant_profiles` (`id` INT NOT NULL AUTO_INCREMENT , `merchant_id` INT NOT NULL , `avatar` VARCHAR(255) NOT NULL , `email` VARCHAR(255) NOT NULL , `phone` VARCHAR(100) NOT NULL , `website` VARCHAR(255) NOT NULL , `deleted_at` TIMESTAMP NOT NULL , PRIMARY KEY (`id`), INDEX `idx_merchant_id_merchant_profiles` (`merchant_id`)) ENGINE = InnoDB;

                ALTER TABLE `user_profiles` ADD UNIQUE(`user_id`);

                ALTER TABLE `merchant_profiles` ADD UNIQUE(`merchant_id`);

                CREATE TABLE `belajar_database`.`products` (`id` INT NOT NULL AUTO_INCREMENT , `merchant_id` INT NOT NULL , `name` VARCHAR(255) NOT NULL , `image` VARCHAR(255) NOT NULL , `quantity` INT(100) UNSIGNED NOT NULL , `price` DECIMAL(11,2) UNSIGNED NOT NULL , `deleted_at` TIMESTAMP NOT NULL , PRIMARY KEY (`id`), INDEX `id_merchant_id_products` (`merchant_id`)) ENGINE = InnoDB;

                ALTER TABLE `products` ADD CONSTRAINT `fk_merchant_id_products` FOREIGN KEY (`merchant_id`) REFERENCES `merchants`(`id`) ON DELETE RESTRICT ON UPDATE RESTRICT;

                CREATE TABLE `belajar_database`.`orders` (`id` INT NOT NULL AUTO_INCREMENT , `user_id` INT NOT NULL , `merchant_id` INT NOT NULL , `order_numbers` VARCHAR(255) NOT NULL , `checkout_date` TIMESTAMP NOT NULL , `status` ENUM('paid','canceled','expired','refund') NOT NULL , `updated_at` TIMESTAMP NULL , `deleted_at` TIMESTAMP NULL , PRIMARY KEY (`id`)) ENGINE = InnoDB;

                ALTER TABLE `orders` ADD CONSTRAINT `fk_user_id_users` FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE; ALTER TABLE `orders` ADD CONSTRAINT `fk_merchant_id_merchants` FOREIGN KEY (`merchant_id`) REFERENCES `merchants`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE;

                ALTER TABLE `belajar_database`.`orders` ADD INDEX `idx_user_id_merchant_id` (`user_id`, `merchant_id`);

                CREATE TABLE `belajar_database`.`order_items` (`id` INT NOT NULL AUTO_INCREMENT , `order_id` INT NOT NULL , `product_id` INT NOT NULL , `quantity` INT NOT NULL , `total` DECIMAL NOT NULL , `deleted_at` INT NULL , PRIMARY KEY (`id`)) ENGINE = InnoDB;

                ALTER TABLE `order_items` ADD CONSTRAINT `fk_order_id_order_items` FOREIGN KEY (`order_id`) REFERENCES `orders`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE; ALTER TABLE `order_items` ADD CONSTRAINT `fk_product_id_products` FOREIGN KEY (`product_id`) REFERENCES `products`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE;


                CREATE TABLE `belajar_database`.`categories` (`id` INT NOT NULL AUTO_INCREMENT , `name` VARCHAR(255) NOT NULL , `deleted_at` TIMESTAMP NULL , PRIMARY KEY (`id`)) ENGINE = InnoDB;

                CREATE TABLE `belajar_database`.`category_product` (`product_id` INT NOT NULL , `category_id` INT NOT NULL , `deleted_at` TIMESTAMP NULL ) ENGINE = InnoDB;

                ALTER TABLE `belajar_database`.`category_product` ADD INDEX `idx_product_id_category_id` (`product_id`, `category_id`);

                ALTER TABLE `belajar_database`.`category_product` ADD INDEX `idx_category_id` (`product_id`);

                CREATE TABLE `belajar_database`.`audit_logs` (`id` INT NOT NULL AUTO_INCREMENT , `table_name` VARCHAR(255) NOT NULL , `record_id` INT NOT NULL , `action` ENUM('insert','update','delete') NOT NULL , `old_data` JSON NOT NULL , `new_data` JSON NOT NULL , `created_at` TIMESTAMP NOT NULL , `deleted_at` TIMESTAMP NULL , PRIMARY KEY (`id`), INDEX `idx_record_id` (`record_id`), INDEX `idx_table_name` (`table_name`), INDEX `idx_created_at` (`created_at`)) ENGINE = InnoDB;


        


</pre>

        </main>
    </div>

    <script>
        fetch('layout/aside.html').then(response => response.text()).then(data => {
            document.getElementById('aside').innerHTML = data;

            const currentPage = window.location.pathname.split('/').pop();
            const links = document.querySelectorAll('aside a');

            links.forEach(link => {
                if(link.getAttribute('href') == currentPage){
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>